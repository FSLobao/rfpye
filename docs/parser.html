---

title: Parser


keywords: fastai
sidebar: home_sidebar

summary: "Este módulo processa o arquivo bin e extrai os metadados e dados do espectro dos blocos, além de criar estatísticas das medições."
description: "Este módulo processa o arquivo bin e extrai os metadados e dados do espectro dos blocos, além de criar estatísticas das medições."
nb_path: "nbs\01_parser.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs\01_parser.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>C:\Users\rsilva\Miniconda3\envs\rfpye39\lib\site-packages\fastprogress\fastprogress.py:102: UserWarning: Couldn&#39;t import ipywidgets properly, progress bar will use console behavior
  warn(&#34;Couldn&#39;t import ipywidgets properly, progress bar will use console behavior&#34;)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">load_ext</span> line_profiler
<span class="o">%</span><span class="k">load_ext</span> cython
<span class="o">%</span><span class="k">autoreload</span> 2 
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The autoreload extension is already loaded. To reload it, use:
  %reload_ext autoreload
The line_profiler extension is already loaded. To reload it, use:
  %reload_ext line_profiler
The cython extension is already loaded. To reload it, use:
  %reload_ext cython
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CrfsGPS" class="doc_header"><code>class</code> <code>CrfsGPS</code><a href="https://github.com/ronaldokun/rfpye/tree/master/rfpye/parser.py#L46" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CrfsGPS</code>()</p>
</blockquote>
<p>Class with the GPS Attributes from the CRFS Bin File</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CrfsSpectrum" class="doc_header"><code>class</code> <code>CrfsSpectrum</code><a href="https://github.com/ronaldokun/rfpye/tree/master/rfpye/parser.py#L100" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CrfsSpectrum</code>(<strong><code>metadata</code></strong>, <strong><code>precision</code></strong>=<em><code>float32</code></em>) :: <code>GetAttr</code></p>
</blockquote>
<p>Class with the metadata and levels of a spectrum block from a CRFS Bin File</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">CrfsGPS</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class with the GPS Attributes from the CRFS Bin File&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span> <span class="n">L</span> <span class="o">=</span> <span class="n">L</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latitude</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_longitude</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_altitude</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_satellites</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_latitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_longitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_altitude</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_satellites</span><span class="p">)</span>

    <span class="nd">@cached</span>
    <span class="k">def</span> <span class="nf">_gps_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">attrgot</span><span class="p">(</span><span class="s2">&quot;gps_datetime&quot;</span><span class="p">)</span>

    <span class="nd">@cached</span>
    <span class="k">def</span> <span class="nf">_latitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">attrgot</span><span class="p">(</span><span class="s2">&quot;latitude&quot;</span><span class="p">)</span>

    <span class="nd">@cached</span>
    <span class="k">def</span> <span class="nf">_longitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">attrgot</span><span class="p">(</span><span class="s2">&quot;longitude&quot;</span><span class="p">)</span>

    <span class="nd">@cached</span>
    <span class="k">def</span> <span class="nf">_altitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">attrgot</span><span class="p">(</span><span class="s2">&quot;altitude&quot;</span><span class="p">)</span>

    <span class="nd">@cached</span>
    <span class="k">def</span> <span class="nf">_num_satellites</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">attrgot</span><span class="p">(</span><span class="s2">&quot;num_satellites&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">latitude</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_latitude</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_latitude</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">longitude</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_longitude</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_longitude</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">altitude</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_altitude</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_altitude</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_satellites</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_satellites</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_satellites</span> <span class="k">else</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;GPS Data - Median of Coordinates: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">latitude</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">longitude</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2"> Altitude: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">altitude</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> #Satellites: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_satellites</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="k">class</span> <span class="nc">CrfsSpectrum</span><span class="p">(</span><span class="n">GetAttr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class with the metadata and levels of a spectrum block from a CRFS Bin File&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span> <span class="n">L</span> <span class="o">=</span> <span class="n">L</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">precision</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Blocks of Type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">, Thread_id: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">thread_id</span><span class="si">}</span><span class="s2">, Start: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start_mega</span><span class="si">}</span><span class="s2"> MHz, Stop: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">stop_mega</span><span class="si">}</span><span class="s2"> MHz&quot;&quot;&quot;</span>

    <span class="nd">@cached</span>
    <span class="k">def</span> <span class="nf">timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">attrgot</span><span class="p">(</span><span class="s1">&#39;wallclock_datetime&#39;</span><span class="p">)</span>

    <span class="nd">@cached</span>
    <span class="k">def</span> <span class="nf">start_dateidx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;wallclock_datetime&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

    <span class="nd">@cached</span>
    <span class="k">def</span> <span class="nf">stop_dateidx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;wallclock_datetime&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

    <span class="nd">@cached</span>
    <span class="k">def</span> <span class="nf">levels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the spectrum levels&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">UNCOMPRESSED</span><span class="p">:</span>
            <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndata</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">level</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">attrgot</span><span class="p">(</span><span class="s1">&#39;levels&#39;</span><span class="p">)):</span>
                <span class="n">levels</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">level</span>
            <span class="c1"># levels = np.concatenate(self._data.attrgot(&#39;levels&#39;)).reshape((-1, self.ndata))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">COMPRESSED</span><span class="p">:</span>
            <span class="n">levels</span> <span class="o">=</span> <span class="n">cy_extract_compressed</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">attrgot</span><span class="p">(</span><span class="s1">&#39;levels&#39;</span><span class="p">)),</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">),</span>
                <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndata</span><span class="p">),</span>
                <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresh</span><span class="p">),</span>
                <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minimum</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The current block is not of type spectrum or it&#39;s not implemented yet&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span>
            <span class="n">levels</span> <span class="o">=</span> <span class="n">levels</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">levels</span>

    <span class="nd">@cached</span>
    <span class="k">def</span> <span class="nf">frequencies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_mega</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_mega</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ndata</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the matrix formed from the spectrum levels and timestamp&quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frequencies</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Frequencies&quot;</span>
        <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Time&quot;</span>
        <span class="k">return</span> <span class="n">data</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Processamento-do-Arquivo-.bin-e-cria&#231;&#227;o-dos-diferentes-tipos-de-blocos">Processamento do Arquivo <code>.bin</code> e cria&#231;&#227;o dos diferentes tipos de blocos<a class="anchor-link" href="#Processamento-do-Arquivo-.bin-e-cria&#231;&#227;o-dos-diferentes-tipos-de-blocos"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A função a seguir recebe os bytes lidos do arquivo <code>.bin</code> e mapeia esses bytes em diferentes classes de acordo com o tipo de bloco</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A função a seguir recebe os bytes lidos do arquivo <code>.bin</code> e mapeia esses bytes em diferentes classes de acordo com o tipo de bloco</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parse_bin" class="doc_header"><code>parse_bin</code><a href="https://github.com/ronaldokun/rfpye/tree/master/rfpye/parser.py#L242" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parse_bin</code>(<strong><code>bin_file</code></strong>:<code>Union</code>[<code>str</code>, <code>Path</code>], <strong><code>precision</code></strong>=<em><code>float32</code></em>)</p>
</blockquote>
<p>Receives a CRFS binfile and returns a dictionary with the file metadata, a GPS Class and a list with the different Spectrum Classes
A block is a piece of the .bin file with a known start and end and that contains different types of information.
It has several fields: file_type, header, data and footer.
Each field has lengths and information defined in the documentation.
Args:
    bin_file (Union[str, Path]): path to the bin file</p>
<p>Returns:
    Dictionary with the file metadata, file_version, string info, gps and spectrum blocks.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">parse_bin</span><span class="p">(</span><span class="n">bin_file</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span> <span class="n">precision</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Receives a CRFS binfile and returns a dictionary with the file metadata, a GPS Class and a list with the different Spectrum Classes</span>
<span class="sd">    A block is a piece of the .bin file with a known start and end and that contains different types of information.</span>
<span class="sd">    It has several fields: file_type, header, data and footer.</span>
<span class="sd">    Each field has lengths and information defined in the documentation.</span>
<span class="sd">    Args:</span>
<span class="sd">        bin_file (Union[str, Path]): path to the bin file</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary with the file metadata, file_version, string info, gps and spectrum blocks.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bin_file</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">bin_file</span><span class="p">)</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">fluxos</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">gps</span> <span class="o">=</span> <span class="n">CrfsGPS</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">bin_file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="c1"># The first block of the file is the header and is 36 bytes long.</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">BYTES_HEADER</span><span class="p">)</span>
        <span class="n">meta</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bin_file</span><span class="o">.</span><span class="n">name</span>
        <span class="n">meta</span><span class="p">[</span><span class="s2">&quot;file_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bin2int</span><span class="p">(</span><span class="n">header</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">meta</span><span class="p">[</span><span class="s2">&quot;string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bin2str</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span>
        <span class="n">file_size</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">next_block</span> <span class="o">:=</span> <span class="n">file</span><span class="o">.</span><span class="n">tell</span><span class="p">())</span> <span class="o">&lt;</span> <span class="n">file_size</span><span class="p">:</span>
            <span class="n">block_type</span><span class="p">,</span> <span class="n">block</span> <span class="o">=</span> <span class="n">create_block</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">next_block</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">block</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">block_type</span> <span class="o">==</span> <span class="mi">40</span><span class="p">:</span>
                <span class="n">gps</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">block_type</span> <span class="ow">in</span> <span class="n">VECTOR_BLOCKS</span><span class="p">:</span>
                <span class="n">append_spec_data</span><span class="p">(</span><span class="n">block_type</span><span class="p">,</span><span class="n">fluxos</span><span class="p">,</span> <span class="n">block</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">meta</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">getattrs</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">KEY_ATTRS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">block_type</span><span class="p">)))</span>
    <span class="n">meta</span><span class="p">[</span><span class="s2">&quot;gps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gps</span>
    <span class="n">meta</span><span class="p">[</span><span class="s2">&quot;spectrum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">L</span><span class="p">(</span><span class="n">fluxos</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">meta</span>                 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">files</span> <span class="o">=</span> <span class="n">get_files</span><span class="p">(</span><span class="s1">&#39;binfiles/Erro&#39;</span><span class="p">)</span>
<span class="n">file</span> <span class="o">=</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">file</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Path(&#39;binfiles/Erro/rfeye002213_CheckSum&amp;EOF.bin&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dados</span> <span class="o">=</span> <span class="n">parse_bin</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="n">dados</span><span class="p">[</span><span class="s1">&#39;spectrum&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(#20) [Spectrum(type=67, thread_id=300, description=&#39;PMEC 2021 (Faixa 1 de 10).&#39;, start_mega=105, stop_mega=140, dtype=&#39;dBm&#39;, ndata=3584, bw=18457, processing=&#39;peak&#39;, antuid=0),Spectrum(type=67, thread_id=310, description=&#39;PMEC 2021 (Faixa 2 de 10).&#39;, start_mega=155, stop_mega=165, dtype=&#39;dBm&#39;, ndata=1024, bw=18457, processing=&#39;peak&#39;, antuid=0),Spectrum(type=67, thread_id=100, description=&#39;PRD 2021 (Faixa principal 1 de 4).&#39;, start_mega=50, stop_mega=90, dtype=&#39;dBμV/m&#39;, ndata=1024, bw=73828, processing=&#39;peak&#39;, antuid=0),Spectrum(type=67, thread_id=110, description=&#39;PRD 2021 (Faixa principal 2 de 4).&#39;, start_mega=70, stop_mega=110, dtype=&#39;dBμV/m&#39;, ndata=1024, bw=73828, processing=&#39;peak&#39;, antuid=0),Spectrum(type=67, thread_id=120, description=&#39;PRD 2021 (Faixa principal 3 de 4).&#39;, start_mega=170, stop_mega=220, dtype=&#39;dBμV/m&#39;, ndata=1280, bw=73828, processing=&#39;peak&#39;, antuid=0),Spectrum(type=67, thread_id=130, description=&#39;PRD 2021 (Faixa principal 4 de 4).&#39;, start_mega=470, stop_mega=700, dtype=&#39;dBμV/m&#39;, ndata=5888, bw=73828, processing=&#39;peak&#39;, antuid=0),Spectrum(type=67, thread_id=200, description=&#39;PMEF 2021 (Faixa 1 de 6).&#39;, start_mega=700, stop_mega=960, dtype=&#39;dBm&#39;, ndata=6656, bw=73828, processing=&#39;peak&#39;, antuid=0),Spectrum(type=67, thread_id=210, description=&#39;PMEF 2021 (Faixa 2 de 6).&#39;, start_mega=1710, stop_mega=1980, dtype=&#39;dBm&#39;, ndata=6912, bw=73828, processing=&#39;peak&#39;, antuid=0),Spectrum(type=67, thread_id=220, description=&#39;PMEF 2021 (Faixa 3 de 6).&#39;, start_mega=2100, stop_mega=2169, dtype=&#39;dBm&#39;, ndata=1792, bw=73828, processing=&#39;peak&#39;, antuid=0),Spectrum(type=67, thread_id=230, description=&#39;PMEF 2021 (Faixa 4 de 6).&#39;, start_mega=2290, stop_mega=2390, dtype=&#39;dBm&#39;, ndata=2560, bw=73828, processing=&#39;peak&#39;, antuid=0)...]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">dados</span><span class="p">[</span><span class="s1">&#39;spectrum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrgot</span><span class="p">(</span><span class="s1">&#39;thread_id&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dados</span><span class="p">[</span><span class="s1">&#39;spectrum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">len</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">300</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">310</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">100</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">110</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">120</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">130</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">200</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">210</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">220</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">230</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">240</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">250</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">320</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">330</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">340</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">350</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">360</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">370</span>, 
<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">380</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">390</span><span style="font-weight: bold">]</span>
</pre>

</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">[</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9026</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">9034</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1809</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1809</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1810</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">1808</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">603</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">604</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">604</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">602</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">602</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">602</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">604</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">604</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">601</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">602</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">601</span>, 
<span style="color: #008080; text-decoration-color: #008080; font-weight: bold">600</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">601</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">603</span><span style="font-weight: bold">]</span>
</pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dados</span><span class="p">[</span><span class="s1">&#39;spectrum&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(numpy.datetime64(&#39;2021-08-21T12:03:01.699260&#39;),
 array([ -88.5,  -82. ,  -73.5, ..., -102.5, -105. , -105.5], dtype=float32))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%</span><span class="n">cython</span> <span class="o">--</span><span class="n">annotate</span>
<span class="k">cimport</span> <span class="nn">cython</span>

<span class="k">ctypedef</span> <span class="nb">object</span> <span class="n">CrfsGPS</span>

<span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>
Error compiling Cython file:
------------------------------------------------------------
...

ctypedef object CrfsGPS

@cython.boundscheck(False)
@cython.wraparound(False)
^
------------------------------------------------------------

C:\Users\rsilva\.ipython\cython\_cython_magic_98c655412a46cff311afb5f5b8b31186.pyx:7:0: Decorators can only be followed by functions or classes
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

